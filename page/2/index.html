<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/">





  <title>Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/typecho/1-lnmp安装typecho/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/typecho/1-lnmp安装typecho/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-搭建-LNMP-环境"><a href="#1-搭建-LNMP-环境" class="headerlink" title="1.搭建 LNMP 环境"></a>1.搭建 LNMP 环境</h2><h3 id="1-什么是-LNMP"><a href="#1-什么是-LNMP" class="headerlink" title="1. 什么是 LNMP"></a>1. 什么是 LNMP</h3><p><a href="http://www.kamyu.top/go/aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9sbm1w" target="_blank" rel="noopener">LNMP</a> 指是Linux（操作系统）、Nginx（HTTP 服务器），MySQL（数据库软件） 和PHP的第一个字母，主要用来建立web应用平台。</p>
<p>还记得我们之前购买实例的时候，有选择 <em>CentOS</em> 吗？这就是 Linux 的发行版之一。所以，实际上我们只需要安装 NMP（好像有什么奇怪的东西混进来了？LOL）。</p>
<h3 id="2-搭建-NMP"><a href="#2-搭建-NMP" class="headerlink" title="2. 搭建 NMP"></a>2. 搭建 NMP</h3><p>有非常方便的<a href="https://lnmp.org/" target="_blank" rel="noopener">一键安装包</a>帮助我们。</p>
<p>在 SSH 里面，我们输入：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># wget http://soft.vpser.net/lnmp/lnmp1.5.tar.gz -cO lnmp1.5.tar.gz &amp;&amp; tar zxf lnmp1.5.tar.gz &amp;&amp; cd lnmp1.5 &amp;&amp; ./install.sh lnmp</span></span><br></pre></td></tr></table></figure>
<p>运行上述LNMP安装命令后，很快就到了下面的界面，所有选项都选择 Default 的数字序号就可以了，需要特别注意的是，<strong>必须记住数据库的密码：</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|          LNMP V1.5 <span class="keyword">for</span> CentOS Linux Server, Written by Licess          |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|        A tool to auto-compile &amp; install LNMP/LNMPA/LAMP on Linux       |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|           For more information please visit https://lnmp.org           |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">You have 10 options <span class="keyword">for</span> your DataBase install.</span><br><span class="line">1: Install MySQL 5.1.73</span><br><span class="line">2: Install MySQL 5.5.60 (Default)</span><br><span class="line">3: Install MySQL 5.6.40</span><br><span class="line">4: Install MySQL 5.7.22</span><br><span class="line">5: Install MySQL 8.0.11</span><br><span class="line">6: Install MariaDB 5.5.60</span><br><span class="line">7: Install MariaDB 10.0.35</span><br><span class="line">8: Install MariaDB 10.1.33</span><br><span class="line">9: Install MariaDB 10.2.14</span><br><span class="line">0: DO NOT Install MySQL/MariaDB</span><br><span class="line">Enter your choice (1, 2, 3, 4, 5, 6, 7, 8, 9 or 0): 2</span><br><span class="line"></span><br><span class="line">You will install MySQL 5.5.60</span><br><span class="line"></span><br><span class="line">Please setup root password of MySQL.</span><br><span class="line">Please enter: xxxxxx  <span class="comment">##记住mysql root 用户密码</span></span><br><span class="line"></span><br><span class="line">MySQL root password: xxxxxx</span><br><span class="line"></span><br><span class="line">Do you want to <span class="built_in">enable</span> or <span class="built_in">disable</span> the InnoDB Storage Engine?</span><br><span class="line">Default <span class="built_in">enable</span>,Enter your choice [Y/n]: n</span><br><span class="line"></span><br><span class="line">You will <span class="built_in">disable</span> the InnoDB Storage Engine!</span><br><span class="line"></span><br><span class="line">You have 8 options <span class="keyword">for</span> your PHP install.</span><br><span class="line">1: Install PHP 5.2.17</span><br><span class="line">2: Install PHP 5.3.29</span><br><span class="line">3: Install PHP 5.4.45</span><br><span class="line">4: Install PHP 5.5.38</span><br><span class="line">5: Install PHP 5.6.36 (Default)</span><br><span class="line">6: Install PHP 7.0.30</span><br><span class="line">7: Install PHP 7.1.18</span><br><span class="line">8: Install PHP 7.2.6</span><br><span class="line"></span><br><span class="line">Enter your choice (1, 2, 3, 4, 5, 6, 7 or 8): 4</span><br><span class="line"></span><br><span class="line">You will install PHP 5.6.36</span><br><span class="line"></span><br><span class="line">You have 3 options <span class="keyword">for</span> your Memory Allocator install.</span><br><span class="line">1: Don<span class="string">'t install Memory Allocator. (Default)</span></span><br><span class="line"><span class="string">2: Install Jemalloc</span></span><br><span class="line"><span class="string">3: Install TCMalloc</span></span><br><span class="line"><span class="string">Enter your choice (1, 2 or 3): 1</span></span><br><span class="line"><span class="string">You will install not install Memory Allocator.</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>提示”Press any key to install…or Press Ctrl+c to cancel”后，按回车键确认开始安装。<br>LNMP脚本就会自动安装编译Nginx、MySQL、PHP、phpMyAdmin等软件及相关的组件</p>
<p>安装时间可能会几十分钟到几个小时不等，主要是机器的配置网速等原因会造成影响。</p>
</blockquote>
<p>引用来自： <a href="https://lnmp.org/install.html" target="_blank" rel="noopener">LNMP安装帮助</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Checking ...</span><br><span class="line">Nginx: OK</span><br><span class="line">MySQL: OK</span><br><span class="line">PHP: OK</span><br><span class="line">PHP-FPM: OK</span><br><span class="line">Clean src directory...</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|          LNMP V1.5 <span class="keyword">for</span> CentOS Linux Server, Written by Licess          |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|           For more information please visit https://lnmp.org           |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|    lnmp status manage: lnmp &#123;start|stop|reload|restart|<span class="built_in">kill</span>|status&#125;    |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|  phpMyAdmin: http://IP/phpmyadmin/                                     |</span><br><span class="line">|  phpinfo: http://IP/phpinfo.php                                        |</span><br><span class="line">|  Prober:  http://IP/p.php                                              |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|  Add VirtualHost: lnmp vhost add                                       |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|  Default directory: /home/wwwroot/default                              |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">|  MySQL/MariaDB root password: myblog                          |</span><br><span class="line">+------------------------------------------------------------------------+</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|    Manager <span class="keyword">for</span> LNMP, Written by Licess    |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|              https://lnmp.org             |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">nginx (pid 17315 17314 17313) is running...</span><br><span class="line">php-fpm is runing!</span><br><span class="line"> SUCCESS! MySQL running (17714)</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address               Foreign Address             State      </span><br><span class="line">tcp        0      0 0.0.0.0:80                  0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0      0 0.0.0.0:28436               0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0      0 0.0.0.0:3306                0.0.0.0:*                   LISTEN      </span><br><span class="line">tcp        0      0 :::28436                    :::*                        LISTEN      </span><br><span class="line">Install lnmp takes 18 minutes.</span><br><span class="line">Install lnmp V1.5 completed! enjoy it.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果显示Nginx: OK，MySQL: OK，PHP: OK</p>
<p>并且Nginx、MySQL、PHP都是running，80和3306端口都存在，并提示安装使用的时间及Install lnmp V1.5 completed! enjoy it.的话，说明已经安装成功。<br>某些系统可能会一直卡在Install lnmp V1.5 completed! enjoy it.不自动退出，可以按Ctrl+c退出。</p>
</blockquote>
<p>引用来自： <a href="http://www.kamyu.top/go/aHR0cHM6Ly9sbm1wLm9yZy9pbnN0YWxsLmh0bWw=" target="_blank" rel="noopener">LNMP安装帮助</a></p>
<ul>
<li>需要注意，80 和 3306 端口都必须已经在你的服务器中开启！</li>
<li>如果没有正确地完成，你可以访问 <a href="http://www.kamyu.top/go/aHR0cHM6Ly9sbm1wLm9yZy9pbnN0YWxsLmh0bWw=" target="_blank" rel="noopener">LNMP安装帮助</a> 来查看官方的文档。</li>
<li>如果已经完成，恭喜你！离搭建完成不远了！</li>
</ul>
<h2 id="2-添加域名"><a href="#2-添加域名" class="headerlink" title="2.添加域名"></a>2.添加域名</h2><p>添加域名：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lnmp vhost add</span><br></pre></td></tr></table></figure>
<p>回车，提示输入域名：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www.wuyg.top <span class="comment"># 这里输入www.你的域名</span></span><br><span class="line">Please enter domain(example: www.lnmp.org): www.wuyg.top</span><br><span class="line">Your domain: www.wuyg.top</span><br></pre></td></tr></table></figure>
<p>回车，提示是否添加多个域名：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wuyg.top <span class="comment"># 这里输入你的顶级域名</span></span><br><span class="line">Enter more domain name(example: lnmp.org *.lnmp.org): wuyg.top *.wuyg.top</span><br><span class="line"> domain list: wuyg.top *.wuyg.top</span><br></pre></td></tr></table></figure>
<p>回车，显示网站目录。默认即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Default directory: /home/wwwroot/www.wuyg.top: </span><br><span class="line">Virtual Host Directory: /home/wwwroot/www.wuyg.top</span><br></pre></td></tr></table></figure>
<p>注意：这里会让你输入是否开启伪静态（Allow rewrite rules？）</p>
<blockquote>
<p>伪静态可以使URL更加简洁也利于SEO，如程序支持并且需要设置伪静态的话，如启用输入 y ，不启用输入 n 回车(注意LNMPA或LAMP模式没有该选择项！)。</p>
</blockquote>
<p>由于我们准备安装的是 Typecho，后面显示 URL 需要优化，我们需要开启伪静态，我们这里输入 y</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y</span><br></pre></td></tr></table></figure>
<p>下面会问你怎么选伪静态配置文件，默认已经有了discuz、discuzx、discuzx2(Discuz X二级目录)、wordpress、wp2(WordPress二级目录)、typecho、typecho2(Typecho二级目录)、sablog、emlog、dabr、phpwind、、dedecms、drupal、ecshop、shopex。</p>
<p>很明显我们应该选 typecho：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typecho</span><br></pre></td></tr></table></figure>
<p>回车，开启日志记录：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y</span><br></pre></td></tr></table></figure>
<p>回车后，输入站长邮箱即可。</p>
<p>继续回车，提示数据库名和数据库用户名是否保持一致。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y</span><br></pre></td></tr></table></figure>
<p>回车，输入 <em>root</em> 用户的数据库密码（上面配置 LNMP 时让你记住的密码），这里是不会显示密码的，输入后回车即可。</p>
<p>回车，输入数据库名，如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typecho_db</span><br></pre></td></tr></table></figure>
<p>回车，设置数据库密码。例如：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">typecho_db_password</span><br></pre></td></tr></table></figure>
<p>是否需要开启SSL/HTTPS访问，我们这里先不开启：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n</span><br></pre></td></tr></table></figure>
<blockquote>
<p>提示 <em>Press any key to start create virtul host…</em> 后，回车确认便会开始创建虚拟主机。</p>
<p>添加成功会提示添加的域名、目录、伪静态、日志、数据库、FTP等相关信息</p>
</blockquote>
<p>以上引用来自：<a href="http://www.kamyu.top/go/aHR0cHM6Ly9sbm1wLm9yZy9mYXEvbG5tcC12aG9zdC1hZGQtaG93dG8uaHRtbA==" target="_blank" rel="noopener">LNMP添加虚拟主机帮助</a></p>
<p>如（这些信息你可以保存起来）：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">================================================</span><br><span class="line">Virtualhost infomation:</span><br><span class="line">Your domain: 你的域名</span><br><span class="line">Home Directory: 你的主页路径</span><br><span class="line">Rewrite: typecho</span><br><span class="line">Enable <span class="built_in">log</span>: yes</span><br><span class="line">Database username: 你的数据库名字</span><br><span class="line">Database userpassword: 你的数据库密码</span><br><span class="line">Database Name: 你的数据库名字</span><br><span class="line">Create ftp account: no</span><br><span class="line">================================================</span><br></pre></td></tr></table></figure>
<p>如果需要更详细的信息，可以前往<a href="http://www.kamyu.top/go/aHR0cHM6Ly9sbm1wLm9yZy9mYXEvbG5tcC12aG9zdC1hZGQtaG93dG8uaHRtbA==" target="_blank" rel="noopener">LNMP添加虚拟主机帮助</a>。</p>
<h2 id="3-安装-Typecho"><a href="#3-安装-Typecho" class="headerlink" title="3. 安装 Typecho"></a>3. 安装 Typecho</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@host wuyg.top]<span class="comment"># cd /home/wwwroot/wuyg.top/</span></span><br><span class="line">[root@host wuyg.top]<span class="comment"># wget http://typecho.org/downloads/1.1-17.10.30-release.tar.gz</span></span><br><span class="line">[root@host wuyg.top]<span class="comment"># mv build/* .</span></span><br><span class="line">[root@host wuyg.top]<span class="comment"># rm -rf build/</span></span><br></pre></td></tr></table></figure>
<p>访问你的域名，进行配置</p>
<h2 id="4-安装SSL证书"><a href="#4-安装SSL证书" class="headerlink" title="4.安装SSL证书"></a>4.安装SSL证书</h2><h3 id="1-一键生成证书"><a href="#1-一键生成证书" class="headerlink" title="1.一键生成证书"></a>1.一键生成证书</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@blog ~]<span class="comment"># lnmp ssl add</span></span><br><span class="line"></span><br><span class="line">Please enter domain(example: www.lnmp.org): www.wuyg.top</span><br><span class="line">Your domain: www.wuyg.top</span><br><span class="line">Enter more domain name(example: lnmp.org *.lnmp.org):</span><br><span class="line">Please enter the directory <span class="keyword">for</span> domain v.laobuluo.com: /home/wwwroot/wuyu.top</span><br><span class="line">Allow Rewrite rule? (y/n) y</span><br><span class="line">Please enter the rewrite of programme,</span><br><span class="line">wordpress,discuz,typecho,sablog,typecho rewrite was exist.</span><br><span class="line">(Default rewrite: other): wordpress</span><br><span class="line">You choose rewrite: typecho</span><br><span class="line">Allow access <span class="built_in">log</span>? (y/n) y</span><br><span class="line">Enter access <span class="built_in">log</span> filename(Default:www.wuyg.top.log):</span><br><span class="line">You access <span class="built_in">log</span> filename: www.wuyg.top.log</span><br><span class="line">1: Use your own SSL Certificate and Key</span><br><span class="line">2: Use Let<span class="string">'s Encrypt to create SSL Certificate and Key</span></span><br><span class="line"><span class="string">Enter 1 or 2: 2</span></span><br></pre></td></tr></table></figure>
<h3 id="2-本文是生成通配符证书比较麻烦"><a href="#2-本文是生成通配符证书比较麻烦" class="headerlink" title="2.本文是生成通配符证书比较麻烦"></a>2.本文是<strong><code>生成通配符证书</code></strong>比较麻烦</h3><blockquote>
<p>Wildcard certificate俗称野卡正式点一般称为通配符或泛域名证书，也就是为*.wyg.top签发包含所有子域名的SSL证书</p>
<p>LNMP 1.5已经添加了对通配符证书的支持，生成通配符证书和Let’sEncrypt平常SSL证书命令有些差异（通配符证书命令是 <strong>lnmp dnsssl</strong> 域名dns服务商简称，普通证书是<strong>lnmp ssl add</strong>），最好是使用域名DNS服务商的API，这样才能实现自动续期。</p>
</blockquote>
<p>可参考<a href="https://lnmp.org/faq/letsencrypt-wildcard-ssl.html" target="_blank" rel="noopener">官方教程</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">###本人用的阿里云的域名，域名DNS服务商API操作所需的参数，如Key、Secret如下</span></span><br><span class="line">[root@host wuyg.top]<span class="comment"># export Ali_Key="xxxxxx" </span></span><br><span class="line">[root@host wuyg.top]<span class="comment"># export Ali_Secret="xxxxxx"</span></span><br></pre></td></tr></table></figure>
<p>下面开工开始添加虚拟主机并生成通配符SSL证书，命令：<strong>lnmp dnsssl ali或 lnmp dns ali</strong></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@host wuyg.top]<span class="comment"># lnmp dnsssl ali</span></span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|    Manager <span class="keyword">for</span> LNMP, Written by Licess    |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">|              https://lnmp.org             |</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">/usr/<span class="built_in">local</span>/acme.sh/acme.sh [found]</span><br><span class="line">Please enter domain(example: www.lnmp.org): wuyg.top</span><br><span class="line"> Your domain: wuyg.top  <span class="comment">##注意：如果要生成通配符/泛域名SSL证书，输入其他域名时不要输入www.wuyg.top 的域名，否则将生成失败！！！</span></span><br><span class="line">Enter more domain name(example: lnmp.org *.lnmp.org): *.wuyg.top</span><br><span class="line"> domain list: *.wuyg.top <span class="comment">##输入其他域名</span></span><br><span class="line">Please enter the directory <span class="keyword">for</span> domain wuyg.top: /home/wwwroot/wuyg.top <span class="comment">##typecho目录</span></span><br><span class="line">Allow Rewrite rule? (y/n) y <span class="comment">##是否添加伪静态</span></span><br><span class="line">Please enter the rewrite of programme, </span><br><span class="line">wordpress,discuzx,typecho,thinkphp,laravel,codeigniter,yii2 rewrite was exist.</span><br><span class="line">(Default rewrite: other): typecho</span><br><span class="line">You choose rewrite: typecho</span><br><span class="line">Allow access <span class="built_in">log</span>? (y/n) y</span><br><span class="line">Enter access <span class="built_in">log</span> filename(Default:wuyg.top.log): </span><br><span class="line">You access <span class="built_in">log</span> filename: wuyg.top.log</span><br><span class="line">Enable PHP Pathinfo? (y/n) y</span><br><span class="line">Enable pathinfo.</span><br><span class="line">Starting create SSL Certificate use Let<span class="string">'s Encrypt...</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:33:56 CST 2019] Multi domain='</span>DNS:wuyg.top,DNS:*.wuyg.top<span class="string">'</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:33:56 CST 2019] Getting domain auth token for each domain</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:33:57 CST 2019] Getting webroot for domain='</span>wuyg.top<span class="string">'</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:33:57 CST 2019] Getting webroot for domain='</span>*.wuyg.top<span class="string">'</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:33:57 CST 2019] Found domain api file: /usr/local/acme.sh/dnsapi/dns_ali.sh</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:34:01 CST 2019] Found domain api file: /usr/local/acme.sh/dnsapi/dns_ali.sh</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:34:04 CST 2019] Sleep 120 seconds for the txt records to take effect ##等待两分钟</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:06 CST 2019] Verifying:wuyg.top</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:08 CST 2019] Success</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:08 CST 2019] Verifying:*.wuyg.top</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:10 CST 2019] Success</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:10 CST 2019] Removing DNS records.</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:26 CST 2019] Verify finished, start to sign.</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] Cert success.</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] Your cert is in  /usr/local/nginx/conf/ssl/wuyg.top/wuyg.top.cer </span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] Your cert key is in  /usr/local/nginx/conf/ssl/wuyg.top/wuyg.top.key </span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] The intermediate CA cert is in  /usr/local/nginx/conf/ssl/wuyg.top/ca.cer </span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] And the full chain certs is there:  /usr/local/nginx/conf/ssl/wuyg.top/fullchain.cer </span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] Run reload cmd: /etc/init.d/nginx reload</span></span><br><span class="line"><span class="string">Reload service nginx...  done</span></span><br><span class="line"><span class="string">[Sat Jan 19 00:36:27 CST 2019] Reload success</span></span><br><span class="line"><span class="string">Create dhparam.pem...</span></span><br><span class="line"><span class="string">Generating DH parameters, 2048 bit long safe prime, generator 2</span></span><br><span class="line"><span class="string">This is going to take a long time</span></span><br><span class="line"><span class="string">............................................................+..............................................++*++*</span></span><br><span class="line"><span class="string">Test Nginx configure file......</span></span><br><span class="line"><span class="string">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span></span><br><span class="line"><span class="string">nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</span></span><br><span class="line"><span class="string">Reload Nginx......</span></span><br><span class="line"><span class="string">Let'</span>s Encrypt SSL Certificate create successfully.</span><br></pre></td></tr></table></figure>
<p>再通过https访问你的域名，发现 可以了</p>
<h3 id="3-强制https访问"><a href="#3-强制https访问" class="headerlink" title="3.强制https访问"></a>3.强制https访问</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@blog nginx]<span class="comment"># cd   </span></span><br><span class="line">[root@blog vhost]<span class="comment"># vi wuyg.top.conf  ##编辑站点ngixn配置</span></span><br><span class="line"></span><br><span class="line">server</span><br><span class="line">    &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        <span class="comment">#listen [::]:80;</span></span><br><span class="line">        server_name wuyg.top *.wuyg.top;</span><br><span class="line">        index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">        root  /home/wwwroot/wuyg.top;</span><br><span class="line"></span><br><span class="line">        rewrite ^(.*) https://<span class="variable">$server_name</span><span class="variable">$1</span> permanent; <span class="comment">###加上这句</span></span><br><span class="line"></span><br><span class="line">        include rewrite/typecho.conf;</span><br><span class="line">        <span class="comment">#error_page   404   /404.html;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Deny access to PHP files in specific directory</span></span><br><span class="line">        <span class="comment">#location ~ /(wp-content|uploads|wp-includes|images)/.*\.php$ &#123; deny all; &#125;</span></span><br><span class="line"></span><br><span class="line">        include <span class="built_in">enable</span>-php-pathinfo.conf;</span><br><span class="line"></span><br><span class="line">        location ~ .*\.(gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">        &#123;</span><br><span class="line">            expires      30d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ .*\.(js|css)?$</span><br><span class="line">        &#123;</span><br><span class="line">            expires      12h;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ /.well-known &#123;</span><br><span class="line">            allow all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location ~ /\.</span><br><span class="line">        &#123;</span><br><span class="line">            deny all;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        access_log  /home/wwwlogs/wuyg.top.log;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">[root@blog vhost]<span class="comment"># service nginx restart  ##重启ngixn</span></span><br></pre></td></tr></table></figure>
<h2 id="5-安全-amp-优化-amp-遇到的问题"><a href="#5-安全-amp-优化-amp-遇到的问题" class="headerlink" title="5. 安全 &amp; 优化 &amp; 遇到的问题"></a>5. 安全 &amp; 优化 &amp; 遇到的问题</h2><h3 id="1-安全考虑（强烈建议）"><a href="#1-安全考虑（强烈建议）" class="headerlink" title="1. 安全考虑（强烈建议）"></a>1. 安全考虑（强烈建议）</h3><p>为了安全，建议将 <code>phpmyadmin</code> 目录重命名为不容易猜到的目录（比如：XXX）：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/wwwroot/default</span><br><span class="line">mv phpmyadmin XXX</span><br></pre></td></tr></table></figure>
<p>浏览器访问 IP 地址是 LNMP 安装成功页面，建议删除或改名（比如：XXX）：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rm -rf index.html </span><br><span class="line">或者</span><br><span class="line">mv index.html XXX.html</span><br></pre></td></tr></table></figure>
<h3 id="2-Gzip-加速（建议）"><a href="#2-Gzip-加速（建议）" class="headerlink" title="2. Gzip 加速（建议）"></a>2. Gzip 加速（建议）</h3><blockquote>
<p>开GZIP有什么好处？</p>
<p>答：Gzip开启以后会将输出到用户浏览器的数据进行压缩的处理，这样就会减小通过网络传输的数据量，提高浏览的速度。</p>
</blockquote>
<p>你需要找到你所使用主题的 index.php，在头部加上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ob_start(&apos;ob_gzhandler&apos;);</span><br></pre></td></tr></table></figure>
<p>这里使用 FileZilla 找到该文件，下载，修改，然后上传即可，非常方便。</p>
<p>路径是：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">你的主页路径/usr/themes/在使用的主题名/index.php</span><br></pre></td></tr></table></figure>
<p>在这个位置添加：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这是 Typecho 0.9 系统的一套默认皮肤</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@package</span> Typecho Replica Theme </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Typecho Team</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> 1.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@link</span> http://typecho.org</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">ob_start(<span class="string">'ob_gzhandler'</span>); <span class="comment">// 添加的位置</span></span><br></pre></td></tr></table></figure>
<p><a href="http://tool.chinaz.com/gzips/" target="_blank" rel="noopener">站长工具</a>检测</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Spark/1-RDD 的编程 API /">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Spark/1-RDD 的编程 API /" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="RDD-的编程-API"><a href="#RDD-的编程-API" class="headerlink" title="RDD 的编程 API"></a>RDD 的编程 API</h1><h2 id="Transformation"><a href="#Transformation" class="headerlink" title="Transformation"></a>Transformation</h2><p><a href="http://spark.apache.org/docs/latest/rdd-programming-guide.html#transformatio" target="_blank" rel="noopener">官网</a></p>
<table>
<thead>
<tr>
<th>Transformation</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>map</strong>(<em>func</em>)</td>
<td>Return a new distributed dataset formed by passing each element of the source through a function <em>func</em>.</td>
</tr>
<tr>
<td><strong>filter</strong>(<em>func</em>)</td>
<td>Return a new dataset formed by selecting those elements of the source on which <em>func</em>returns true.</td>
</tr>
<tr>
<td><strong>flatMap</strong>(<em>func</em>)</td>
<td>Similar to map, but each input item can be mapped to 0 or more output items (so <em>func</em> should return a Seq rather than a single item).</td>
</tr>
<tr>
<td><strong>mapPartitions</strong>(<em>func</em>)</td>
<td>Similar to map, but runs separately on each partition (block) of the RDD, so <em>func</em> must be of type Iterator<t> =&gt; Iterator<u> when running on an RDD of type T.</u></t></td>
</tr>
<tr>
<td><strong>mapPartitionsWithIndex</strong>(<em>func</em>)</td>
<td>Similar to mapPartitions, but also provides <em>func</em> with an integer value representing the index of the partition, so <em>func</em> must be of type (Int, Iterator<t>) =&gt; Iterator<u> when running on an RDD of type T.</u></t></td>
</tr>
<tr>
<td><strong>sample</strong>(<em>withReplacement</em>, <em>fraction</em>, <em>seed</em>)</td>
<td>Sample a fraction <em>fraction</em> of the data, with or without replacement, using a given random number generator seed.</td>
</tr>
<tr>
<td><strong>union</strong>(<em>otherDataset</em>)</td>
<td>Return a new dataset that contains the union of the elements in the source dataset and the argument.</td>
</tr>
<tr>
<td><strong>intersection</strong>(<em>otherDataset</em>)</td>
<td>Return a new RDD that contains the intersection of elements in the source dataset and the argument.</td>
</tr>
<tr>
<td><strong>distinct</strong>([<em>numPartitions</em>]))</td>
<td>Return a new dataset that contains the distinct elements of the source dataset.</td>
</tr>
<tr>
<td><strong>groupByKey</strong>([<em>numPartitions</em>])</td>
<td>When called on a dataset of (K, V) pairs, returns a dataset of (K, Iterable<v>) pairs.  <strong>Note:</strong> If you are grouping in order to perform an aggregation (such as a sum or average) over each key, using <code>reduceByKey</code> or <code>aggregateByKey</code> will yield much better performance.  <strong>Note:</strong> By default, the level of parallelism in the output depends on the number of partitions of the parent RDD. You can pass an optional <code>numPartitions</code> argument to set a different number of tasks.</v></td>
</tr>
<tr>
<td><strong>reduceByKey</strong>(<em>func</em>, [<em>numPartitions</em>])</td>
<td>When called on a dataset of (K, V) pairs, returns a dataset of (K, V) pairs where the values for each key are aggregated using the given reduce function <em>func</em>, which must be of type (V,V) =&gt; V. Like in <code>groupByKey</code>, the number of reduce tasks is configurable through an optional second argument.</td>
</tr>
<tr>
<td><strong>aggregateByKey</strong>(<em>zeroValue</em>)(<em>seqOp</em>, <em>combOp</em>, [<em>numPartitions</em>])</td>
<td>When called on a dataset of (K, V) pairs, returns a dataset of (K, U) pairs where the values for each key are aggregated using the given combine functions and a neutral “zero” value. Allows an aggregated value type that is different than the input value type, while avoiding unnecessary allocations. Like in <code>groupByKey</code>, the number of reduce tasks is configurable through an optional second argument.</td>
</tr>
<tr>
<td><strong>sortByKey</strong>([<em>ascending</em>], [<em>numPartitions</em>])</td>
<td>When called on a dataset of (K, V) pairs where K implements Ordered, returns a dataset of (K, V) pairs sorted by keys in ascending or descending order, as specified in the boolean <code>ascending</code> argument.</td>
</tr>
<tr>
<td><strong>join</strong>(<em>otherDataset</em>, [<em>numPartitions</em>])</td>
<td>When called on datasets of type (K, V) and (K, W), returns a dataset of (K, (V, W)) pairs with all pairs of elements for each key. Outer joins are supported through <code>leftOuterJoin</code>, <code>rightOuterJoin</code>, and <code>fullOuterJoin</code>.</td>
</tr>
<tr>
<td><strong>cogroup</strong>(<em>otherDataset</em>, [<em>numPartitions</em>])</td>
<td>When called on datasets of type (K, V) and (K, W), returns a dataset of (K, (Iterable<v>, Iterable<w>)) tuples. This operation is also called <code>groupWith</code>.</w></v></td>
</tr>
<tr>
<td><strong>cartesian</strong>(<em>otherDataset</em>)</td>
<td>When called on datasets of types T and U, returns a dataset of (T, U) pairs (all pairs of elements).</td>
</tr>
<tr>
<td><strong>pipe</strong>(<em>command</em>, <em>[envVars]</em>)</td>
<td>Pipe each partition of the RDD through a shell command, e.g. a Perl or bash script. RDD elements are written to the process’s stdin and lines output to its stdout are returned as an RDD of strings.</td>
</tr>
<tr>
<td><strong>coalesce</strong>(<em>numPartitions</em>)</td>
<td>Decrease the number of partitions in the RDD to numPartitions. Useful for running operations more efficiently after filtering down a large dataset.</td>
</tr>
<tr>
<td><strong>repartition</strong>(<em>numPartitions</em>)</td>
<td>Reshuffle the data in the RDD randomly to create either more or fewer partitions and balance it across them. This always shuffles all data over the network.</td>
</tr>
<tr>
<td><strong>repartitionAndSortWithinPartitions</strong>(<em>partitioner</em>)</td>
<td>Repartition the RDD according to the given partitioner and, within each resulting partition, sort records by their keys. This is more efficient than calling <code>repartition</code> and then sorting within each partition because it can push the sorting down into the shuffle machinery.</td>
</tr>
</tbody>
</table>
<h2 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h2><p>The following table lists some of the common actions supported by Spark. Refer to the RDD API doc (<a href="https://spark.apache.org/docs/2.3.3/api/scala/index.html#org.apache.spark.rdd.RDD" target="_blank" rel="noopener">Scala</a>, <a href="https://spark.apache.org/docs/2.3.3/api/java/index.html?org/apache/spark/api/java/JavaRDD.html" target="_blank" rel="noopener">Java</a>, <a href="https://spark.apache.org/docs/2.3.3/api/python/pyspark.html#pyspark.RDD" target="_blank" rel="noopener">Python</a>, <a href="https://spark.apache.org/docs/2.3.3/api/R/index.html" target="_blank" rel="noopener">R</a>)</p>
<p>and pair RDD functions doc (<a href="https://spark.apache.org/docs/2.3.3/api/scala/index.html#org.apache.spark.rdd.PairRDDFunctions" target="_blank" rel="noopener">Scala</a>, <a href="https://spark.apache.org/docs/2.3.3/api/java/index.html?org/apache/spark/api/java/JavaPairRDD.html" target="_blank" rel="noopener">Java</a>) for details.</p>
<table>
<thead>
<tr>
<th>Action</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>reduce</strong>(<em>func</em>)</td>
<td>Aggregate the elements of the dataset using a function <em>func</em> (which takes two arguments and returns one). The function should be commutative and associative so that it can be computed correctly in parallel.</td>
</tr>
<tr>
<td><strong>collect</strong>()</td>
<td>Return all the elements of the dataset as an array at the driver program. This is usually useful after a filter or other operation that returns a sufficiently small subset of the data.</td>
</tr>
<tr>
<td><strong>count</strong>()</td>
<td>Return the number of elements in the dataset.</td>
</tr>
<tr>
<td><strong>first</strong>()</td>
<td>Return the first element of the dataset (similar to take(1)).</td>
</tr>
<tr>
<td><strong>take</strong>(<em>n</em>)</td>
<td>Return an array with the first <em>n</em> elements of the dataset.</td>
</tr>
<tr>
<td><strong>takeSample</strong>(<em>withReplacement</em>, <em>num</em>, [<em>seed</em>])</td>
<td>Return an array with a random sample of <em>num</em> elements of the dataset, with or without replacement, optionally pre-specifying a random number generator seed.</td>
</tr>
<tr>
<td><strong>takeOrdered</strong>(<em>n</em>, <em>[ordering]</em>)</td>
<td>Return the first <em>n</em> elements of the RDD using either their natural order or a custom comparator.</td>
</tr>
<tr>
<td><strong>saveAsTextFile</strong>(<em>path</em>)</td>
<td>Write the elements of the dataset as a text file (or set of text files) in a given directory in the local filesystem, HDFS or any other Hadoop-supported file system. Spark will call toString on each element to convert it to a line of text in the file.</td>
</tr>
<tr>
<td><strong>saveAsSequenceFile</strong>(<em>path</em>)  (Java and Scala)</td>
<td>Write the elements of the dataset as a Hadoop SequenceFile in a given path in the local filesystem, HDFS or any other Hadoop-supported file system. This is available on RDDs of key-value pairs that implement Hadoop’s Writable interface. In Scala, it is also available on types that are implicitly convertible to Writable (Spark includes conversions for basic types like Int, Double, String, etc).</td>
</tr>
<tr>
<td><strong>saveAsObjectFile</strong>(<em>path</em>)  (Java and Scala)</td>
<td>Write the elements of the dataset in a simple format using Java serialization, which can then be loaded using<code>SparkContext.objectFile()</code>.</td>
</tr>
<tr>
<td><strong>countByKey</strong>()</td>
<td>Only available on RDDs of type (K, V). Returns a hashmap of (K, Int) pairs with the count of each key.</td>
</tr>
<tr>
<td><strong>foreach</strong>(<em>func</em>)</td>
<td>Run a function <em>func</em> on each element of the dataset. This is usually done for side effects such as updating an <a href="https://spark.apache.org/docs/2.3.3/rdd-programming-guide.html#accumulators" target="_blank" rel="noopener">Accumulator</a> or interacting with external storage systems.  <strong>Note</strong>: modifying variables other than Accumulators outside of the <code>foreach()</code> may result in undefined behavior. See <a href="https://spark.apache.org/docs/2.3.3/rdd-programming-guide.html#understanding-closures-a-nameclosureslinka" target="_blank" rel="noopener">Understanding closures </a>for more details.</td>
</tr>
</tbody>
</table>
<p>The Spark RDD API also exposes asynchronous versions of some actions, like <code>foreachAsync</code> for <code>foreach</code>, which immediately return a <code>FutureAction</code> to the caller instead of blocking on completion of the action. This can be used to manage or wait for the asynchronous execution of the action.</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/9-Hive数据倾斜/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/9-Hive数据倾斜/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hive中的数据倾斜</p>
<p>1.join关联时有null值，所以null值分配到某一分区</p>
<p>解决：1.null不关联</p>
<p>​          2.将null加随机数，如null982,null743，正常分区</p>
<p>2.不同数据类型关联产生数据倾斜</p>
<p>用户表user_id字段为int，log表中user_id为string。两表按user_id join时，map产生的结果为既有string也有int的类型的键。默认的hash会按int类型的id进行分区，这样导致所有string类型的id被分到同一个reducer中</p>
<p>解决：把数字类型id转换成string类型</p>
<p>select * from user u left outer join log l on l.user_id=cast(u.user_id as string);</p>
<p>3.大表关联小表查询产生数据倾斜</p>
<p>map端join效率高，并行度高，不易产生数据倾斜</p>
<p>//设置mapjoin优化，2.0默认开启</p>
<p>set hive.auto.convert.join=true;</p>
<p>//</p>
<p>set hive.mapjoin.smalltable.filesize=25000000</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/8-Hive优化/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/8-Hive优化/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Hive优化"><a href="#Hive优化" class="headerlink" title="Hive优化"></a>Hive优化</h1><p>1.排序选择</p>
<p>order by</p>
<p>sort by</p>
<p>distribute by</p>
<p>cluster by</p>
<p>2.迪卡尔积</p>
<p>3.合理设计maptask个数</p>
<p>jvm重用：一个container可以运行多个maptask和reducetask</p>
<p>4.合理设计reducetask个数</p>
<p>5.in/exists不要用，用left semi join代替</p>
<p>6.能使用多重查询插入的时候不要用单重查询插入</p>
<p>多次扫描</p>
<p>insert into table stu select * from student where age=18;</p>
<p>insert into table stu select * from student where age=19</p>
<p>insert into table stu select * from student where age=20;</p>
<p>一次扫描，提高效率</p>
<p>from student</p>
<p>insert into table stu  select * from student where age=18,</p>
<p>insert into table stu  select * from student where age=19,</p>
<p>insert into table stu  select * from student where age=20,</p>
<p>insert into table stu02  select * from student where age=20；</p>
<p>7.合理设计分区</p>
<p>8.合理设计分桶</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/7-shell命令执行hive脚本（hive交互，hive的shell编程）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/7-shell命令执行hive脚本（hive交互，hive的shell编程）/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="shell命令执行hive脚本（hive交互，hive的shell编程）"><a href="#shell命令执行hive脚本（hive交互，hive的shell编程）" class="headerlink" title="shell命令执行hive脚本（hive交互，hive的shell编程）"></a>shell命令执行hive脚本（hive交互，hive的shell编程）</h1><p>Hive执行方式<br>Hive的hql命令执行方式有三种：<br>1、CLI 方式直接执行<br>2、作为字符串通过shell调用hive –e执行（-S开启静默，去掉”OK”，”Time taken”）<br>3、作为独立文件，通过shell调用 hive –f或hive –i执行执行</p>
<p>方式1<br>键入“hive”，启动hive的cli交互模式。Set可以查看所有环境设置参数，并可以重设。其他命令如，<br>    Use database        选择库<br>    quit/exit   退出Hive的交互模式<br>    set –v  显示Hive中的所有变量<br>    set <key>=<value>       设置参数<br>    执行本地shell ：!<cmd>       交互模式下可执行shell命令，例如（查看linux根目录下文件列表：”!ls -l /;”）<br>    操作云命令：dfs &lt; command&gt;        交互模式下直接操作hadoop命令如 dfs fs –ls<br>    Hql语句       执行查询并输出到标准输出<br>    add [FILE|JAR|ARCHIVE] <value> [<value>]*       增加一个文件到资源列表<br>    list FILE       列出所有已经添加的资源</value></value></cmd></value></key></p>
<p>方式二<br>Hql作为字符串在shell脚本中执行，如<br>    hive -e “use ${database};select <em> from tb”<br>查询结果可以直接导出到本地本件（默认分隔符为\t）:<br>    hive -e “select </em> from tb” &gt; tb.txt</p>
<p>如果需要查看执行步骤，则在命令前面添加<br>    set –x<br>1<br>另外，在shell脚本中，字符串有两种定义方式:<br>1)  直接定义字符串对象：sql=”字符串”</p>
<p>2)  通过命令定义：sql=$(cat &lt;&lt;endtag 字符串endtag)方式可以将字符串复制给sql，执行hql命令的shell脚本如下：</p>
<p>####### execute hive ######<br>sql=$(cat &lt;&lt;!EOF</p>
<p>USE pmp;<br>set mapred.queue.names=queue3;</p>
<p>drop table if exists people_targeted_delivery;<br>create table people_targeted_delivery<br>( special_tag_id int,<br>  cnt bigint<br>);</p>
<p>INSERT OVERWRITE LOCAL DIRECTORY ‘$cur_path/people_targeted_delivery’<br>ROW FORMAT DELIMITED FIELDS TERMINATED BY ‘\t’<br>select special_tag_id,count(1)<br>from t_pmp_special_user_tags<br>group by special_tag_id;</p>
<p>!EOF)</p>
<p>############  execute begin   ###########<br>echo $sql<br>$HIVE_HOME/bin/hive -e “$sql”</p>
<p>exitCode=$?<br>if [ $exitCode -ne 0 ];then<br>         echo “[ERROR] hive execute failed!”<br>         exit $exitCode<br>fi</p>
<p>方式三<br>将hql语句保存为独立文件，后缀名不限制，可以用.q或者.hql作为标识：<br>    A，这个文件在cli模式下，用source命令执行，如：source ./mytest.hql<br>    B，在shell中执行命令，如：hive -f  mytest.sql<br>1<br>2<br>3<br>Hive指定预执行文件命令“hive –i”（或叫初始化文件）<br>命令：hive -i hive-script.sql<br>在hive启动cli之前，先执行指定文件（hive-script.sql）中的命令。<br>也就是说，允许用户在cli启动时预先执行一个指定文件，比如，有一些常用的环境参数设置，频繁执行的命令，可以添加在初始化文件中，比如，<br>    某些参数设置<br>        set mapred.queue.names=queue3;<br>        SET mapred.reduce.tasks=14;<br>    添加udf文件<br>        add JAR ./playdata-hive-udf.jar;<br>    设置Hive的日志级别<br>        hive -hiveconf hive.root.logger=INFO;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/5-自定义函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/5-自定义函数/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h1><p>1.进入hive客户端添加jar包</p>
<p>add jar /home/hadoop/program/hive.jar;</p>
<p>list jars;</p>
<p>2.创建临时函数</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; CREATE TEMPORARY FUNCTION function_name AS <span class="string">'udf类路径'</span>; 这种方法的的缺点很明显就是每次都需要使用这两个命令来完成操作</span><br></pre></td></tr></table></figure>
<p>create temporary function udf01 as ‘com.wyg.day10_udf.MyUDF_01’;</p>
<p>show functions;</p>
<p>临时函数，客户端关闭就销毁，生产一般也也用这种方式</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/4-Hive 中的复合数据结构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/4-Hive 中的复合数据结构/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Hive-中的复合数据结构使用"><a href="#Hive-中的复合数据结构使用" class="headerlink" title="Hive 中的复合数据结构使用"></a>Hive 中的复合数据结构使用</h1><p>目前 hive 支持的复合数据类型有以下几种：</p>
<p>map<br>(key1, value1, key2, value2, …) Creates a map with the given key/value pairs<br>struct<br>(val1, val2, val3, …) Creates a struct with the given field values. Struct field names will be col1, col2, …<br>named_struct<br>(name1, val1, name2, val2, …) Creates a struct with the given field names and values. (as of Hive 0.8.0)<br>array<br>(val1, val2, …) Creates an array with the given elements<br>create_union<br>(tag, val1, val2, …) Creates a union type with the value that is being pointed to by the tag parameter</p>
<h2 id="map、struct、array-这3种的用法："><a href="#map、struct、array-这3种的用法：" class="headerlink" title="map、struct、array 这3种的用法："></a>map、struct、array 这3种的用法：</h2><h3 id="1、Array的使用"><a href="#1、Array的使用" class="headerlink" title="1、Array的使用"></a>1、Array的使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">创建数据库表，以array作为数据类型</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  person(<span class="keyword">name</span> <span class="keyword">string</span>,work_locations <span class="built_in">array</span>&lt;<span class="keyword">string</span>&gt;)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\t'</span></span><br><span class="line">COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br><span class="line"></span><br><span class="line">数据</span><br><span class="line">biansutao beijing,shanghai,tianjin,hangzhou</span><br><span class="line">linan changchu,chengdu,wuhan</span><br><span class="line"></span><br><span class="line">入库数据</span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/home/hadoop/person.txt'</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> person;</span><br><span class="line"></span><br><span class="line">查询</span><br><span class="line">hive&gt; select * from person;</span><br><span class="line">biansutao       ["beijing","shanghai","tianjin","hangzhou"]</span><br><span class="line">linan   ["changchu","chengdu","wuhan"]</span><br><span class="line">Time taken: 0.355 seconds</span><br><span class="line">hive&gt; select name from person;</span><br><span class="line">linan</span><br><span class="line">biansutao</span><br><span class="line">Time taken: 12.397 seconds</span><br><span class="line">hive&gt; select work_locations[0] from person;</span><br><span class="line">changchu</span><br><span class="line">beijing</span><br><span class="line">Time taken: 13.214 seconds</span><br><span class="line">hive&gt; select work_locations from person;   </span><br><span class="line">["changchu","chengdu","wuhan"]</span><br><span class="line">["beijing","shanghai","tianjin","hangzhou"]</span><br><span class="line">Time taken: 13.755 seconds</span><br><span class="line">hive&gt; select work_locations[3] from person;</span><br><span class="line">NULL</span><br><span class="line">hangzhou</span><br><span class="line">Time taken: 12.722 seconds</span><br><span class="line">hive&gt; select work_locations[4] from person;</span><br><span class="line">NULL</span><br><span class="line">NULL</span><br><span class="line">Time taken: 15.958 seconds</span><br></pre></td></tr></table></figure>
<h3 id="2、Map-的使用"><a href="#2、Map-的使用" class="headerlink" title="2、Map 的使用"></a>2、Map 的使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">创建数据库表</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score(<span class="keyword">name</span> <span class="keyword">string</span>, score <span class="keyword">map</span>&lt;<span class="keyword">string</span>,<span class="built_in">int</span>&gt;)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\t'</span></span><br><span class="line">COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span></span><br><span class="line"><span class="keyword">MAP</span> <span class="keyword">KEYS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">':'</span>;</span><br><span class="line">要入库的数据</span><br><span class="line">biansutao '数学':80,'语文':89,'英语':95</span><br><span class="line">jobs '语文':60,'数学':80,'英语':99</span><br><span class="line">入库数据</span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/home/hadoop/score.txt'</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> score;</span><br><span class="line">查询</span><br><span class="line">hive&gt; select * from score;</span><br><span class="line">biansutao       &#123;"数学":80,"语文":89,"英语":95&#125;</span><br><span class="line">jobs    &#123;"语文":60,"数学":80,"英语":99&#125;</span><br><span class="line"></span><br><span class="line">hive&gt; select name from score;</span><br><span class="line">jobs</span><br><span class="line">biansutao</span><br><span class="line"></span><br><span class="line">hive&gt; select t.score from score t;</span><br><span class="line">&#123;"语文":60,"数学":80,"英语":99&#125;</span><br><span class="line">&#123;"数学":80,"语文":89,"英语":95&#125;</span><br><span class="line"></span><br><span class="line">hive&gt; select t.score['语文'] from score t;</span><br><span class="line">60</span><br><span class="line">89</span><br><span class="line"></span><br><span class="line">hive&gt; select t.score['英语'] from score t;</span><br><span class="line">99</span><br><span class="line">95</span><br></pre></td></tr></table></figure>
<h3 id="3、Struct-的使用"><a href="#3、Struct-的使用" class="headerlink" title="3、Struct 的使用"></a>3、Struct 的使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">创建数据表</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>(<span class="keyword">id</span> <span class="built_in">int</span>,course <span class="keyword">struct</span>&lt;course:<span class="keyword">string</span>,score:<span class="built_in">int</span>&gt;)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line"><span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\t'</span></span><br><span class="line">COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span>;</span><br><span class="line">数据</span><br><span class="line">1 english,80</span><br><span class="line">2 math,89</span><br><span class="line">3 chinese,95</span><br><span class="line">入库</span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/home/hadoop/test.txt'</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>;</span><br><span class="line">查询</span><br><span class="line">hive&gt; select * from test;</span><br><span class="line">OK</span><br><span class="line">1       &#123;"course":"english","score":80&#125;</span><br><span class="line">2       &#123;"course":"math","score":89&#125;</span><br><span class="line">3       &#123;"course":"chinese","score":95&#125;</span><br><span class="line"></span><br><span class="line">hive&gt; select course from test;</span><br><span class="line">&#123;"course":"english","score":80&#125;</span><br><span class="line">&#123;"course":"math","score":89&#125;</span><br><span class="line">&#123;"course":"chinese","score":95&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> t.course.course <span class="keyword">from</span> <span class="keyword">test</span> t; </span><br><span class="line">english</span><br><span class="line">math</span><br><span class="line">chinese</span><br><span class="line"></span><br><span class="line">hive&gt; select t.course.score from test t;</span><br><span class="line">80</span><br><span class="line">89</span><br><span class="line">95</span><br></pre></td></tr></table></figure>
<h3 id="4、数据组合-（不支持组合的复杂数据类型）"><a href="#4、数据组合-（不支持组合的复杂数据类型）" class="headerlink" title="4、数据组合 （不支持组合的复杂数据类型）"></a>4、数据组合 （不支持组合的复杂数据类型）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/home/hadoop/test.txt'</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test1(<span class="keyword">id</span> <span class="built_in">int</span>,a <span class="keyword">MAP</span>&lt;<span class="keyword">STRING</span>,<span class="built_in">ARRAY</span>&lt;<span class="keyword">STRING</span>&gt;&gt;)</span><br><span class="line"><span class="keyword">row</span> <span class="keyword">format</span> <span class="keyword">delimited</span> <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">'\t'</span> </span><br><span class="line">collection items <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">','</span></span><br><span class="line"><span class="keyword">MAP</span> <span class="keyword">KEYS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">':'</span>;</span><br><span class="line">1 english:80,90,70</span><br><span class="line">2 math:89,78,86</span><br><span class="line">3 chinese:99,100,82</span><br><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH <span class="string">'/home/hadoop/test1.txt'</span> OVERWRITE <span class="keyword">INTO</span> <span class="keyword">TABLE</span> test1;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/3-Hive内置函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/3-Hive内置函数/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Hive内置函数"><a href="#Hive内置函数" class="headerlink" title="Hive内置函数"></a>Hive内置函数</h1><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><ul>
<li>自定义函数(UDF)，一对一</li>
<li>自定义聚合函数(UDAF)，多对一</li>
<li>自定义表函数(UDTF)，一对多</li>
</ul>
<p>查看内置函数,271个</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> functions;</span><br></pre></td></tr></table></figure>
<p>查看函数描述</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc function sum;</span><br></pre></td></tr></table></figure>
<p>查看函数详细信息</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc function extended sum;</span><br></pre></td></tr></table></figure>
<h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><p>下面表格中的函数为Hive的内置数学函数，大部分当参数为NULL时返回NULL。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bigint</code></td>
<td>round(double a)</td>
<td>返回a经过四舍五入的<code>BIGINT</code> 值</td>
</tr>
<tr>
<td>double</td>
<td>round(double a, int d)</td>
<td>返回a经过四舍五入，保留d位小数的DOUBLE 值</td>
</tr>
<tr>
<td>bigint</td>
<td>floor(double a)</td>
<td>返回小于等于a的最大BIGINT 值</td>
</tr>
<tr>
<td>bigint</td>
<td>ceil(double a), ceiling(double a)</td>
<td>返回大于等于a的最小BIGINT 值</td>
</tr>
<tr>
<td>double</td>
<td>rand(),rand(int seed)</td>
<td>返回一个均匀分布在0到1之间的随机数，指定seed将会确保产生的随机数序列是确定的</td>
</tr>
<tr>
<td>double</td>
<td>exp(double a), exp(decimal a)</td>
<td>返回ea</td>
</tr>
<tr>
<td>double</td>
<td>ln(double a), ln(decimal a)</td>
<td>返回a的自然对数值</td>
</tr>
<tr>
<td>double</td>
<td>log10(double a), log10(decimal a)</td>
<td>返回a的以10为底的对数值</td>
</tr>
<tr>
<td>double</td>
<td>log2(double a), log2(decimal a)</td>
<td>返回a的以2为底的对数值</td>
</tr>
<tr>
<td>double</td>
<td>log(double base, double a)</td>
<td>返回a以base为底的对数值，除了DOUBLE 类型，还可以是DECIMAL 类型，并且两种类型可以混合使用</td>
</tr>
<tr>
<td>double</td>
<td>pow(double a, double p), power(double a, double p)</td>
<td>返回ap</td>
</tr>
<tr>
<td>double</td>
<td>sqrt(double a), sqrt(decimal a)</td>
<td>返回a的平方根</td>
</tr>
<tr>
<td>string</td>
<td>bin(bigint a)</td>
<td>返回a的二进制格式</td>
</tr>
<tr>
<td>string</td>
<td>hex(bigint a)hex(string a)hex(binary a)</td>
<td>如果参数为整数或者二进制，返回十六进制的字符串，如果参数为字符串，该函数将每个字符转换为十六进制表示，并返回结果字符串</td>
</tr>
<tr>
<td>binary</td>
<td>unhex(string a)</td>
<td>将每对字符解释为十六进制并转换为该十六进制的字节表示</td>
</tr>
<tr>
<td>string</td>
<td>conv(bigint num, int from_base, int to_base),conv(string num, int from_base, int to_base)</td>
<td>将数值从一种进制表示转换为另一种进制，比如从二进制转换为十进制</td>
</tr>
<tr>
<td>double</td>
<td>abs(double a)</td>
<td>返回a的绝对值</td>
</tr>
<tr>
<td>int or double</td>
<td>pmod(int a, int b), pmod(double a, double b)</td>
<td>返回a mod b的正数值</td>
</tr>
<tr>
<td>double</td>
<td>sin(double a),sin(decimal a)</td>
<td>返回a的正弦值，a为弧度值</td>
</tr>
<tr>
<td>double</td>
<td>asin(double a), asin(decimal a)</td>
<td>如果1&lt;=a&lt;=-1，返回a的反正弦值，否则返回NULL</td>
</tr>
<tr>
<td>double</td>
<td>cos(double a), cos(decimal a)</td>
<td>返回a的余弦值，a为弧度值</td>
</tr>
<tr>
<td>double</td>
<td>acos(double a), acos(decimal a)</td>
<td>如果-1&lt;=a&lt;=1，返回a的反余弦值，否则返回NULL</td>
</tr>
<tr>
<td>double</td>
<td>tan(double a),tan(decimal a)</td>
<td>返回a的正切值，a为弧度值</td>
</tr>
<tr>
<td>double</td>
<td>atan(double a), atan(decimal a)</td>
<td>返回a的反正切值</td>
</tr>
<tr>
<td>double</td>
<td>degrees(double a), degrees(decimal a)</td>
<td>将a从弧度值转换为对应的角度值</td>
</tr>
<tr>
<td>double</td>
<td>radians(double a), radians(double a)</td>
<td>将a从角度值转换为弧度值</td>
</tr>
<tr>
<td>int or double</td>
<td>positive(int a), positive(double a)</td>
<td>返回a</td>
</tr>
<tr>
<td>int or double</td>
<td>negative(int a), negative(double a)</td>
<td>返回-a</td>
</tr>
<tr>
<td>double or int</td>
<td>sign(double a), sign(decimal a)</td>
<td>如果a为正数返回1.0，若为负数返回-1.0，否则返回0.0。参数为DECIMAL 时返回值为INT类型</td>
</tr>
<tr>
<td>double</td>
<td>e()</td>
<td>返回e的值</td>
</tr>
<tr>
<td>double</td>
<td>pi()</td>
<td>返回π的值</td>
</tr>
</tbody>
</table>
<h2 id="集合函数"><a href="#集合函数" class="headerlink" title="集合函数"></a>集合函数</h2><p>下表为Hive中的集合函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>int</td>
<td>size(Map&lt;K.V&gt;)</td>
<td>返回map中的元素数量</td>
</tr>
<tr>
<td>int</td>
<td>size(Array<t>)</t></td>
<td>返回数组中的元素数量</td>
</tr>
<tr>
<td>array<k></k></td>
<td>map_keys(Map&lt;K.V&gt;)</td>
<td>返回未经排序的包含map中keys的数组</td>
</tr>
<tr>
<td>array<v></v></td>
<td>map_values(Map&lt;K.V&gt;)</td>
<td>返回未经排序的包含map中values的数组</td>
</tr>
<tr>
<td>boolean</td>
<td>array_contains(Array<t>, value)</t></td>
<td>如果数组包含value，返回true</td>
</tr>
<tr>
<td>array<t></t></td>
<td>sort_array(Array<t>)</t></td>
<td>将数组按照升序排序并返回</td>
</tr>
</tbody>
</table>
<h2 id="类型转换函数"><a href="#类型转换函数" class="headerlink" title="类型转换函数"></a>类型转换函数</h2><p>下表为Hive中的类型转换函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>binary</td>
<td>binary(string\</td>
<td>binary)</td>
<td>将输入参数转换为binary</td>
</tr>
<tr>
<td><type></type></td>
<td>cast(expr as <type>)</type></td>
<td>将表达式的结果expr转换为<type>，如果转换不成功则返回NULL，例如cast(‘2014-08-09’ as date)</type></td>
</tr>
</tbody>
</table>
<h2 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h2><p>下表中为Hive中的内置日期函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td>from_unixtime(bigint unixtime[, string format])</td>
<td>将从unix时间（1970-01-01 00：00：00 UTC）开始的秒数转换为表示当前系统时区的时间戳，格式为“1970-01-01 00：00：00”</td>
</tr>
<tr>
<td>bigint</td>
<td>unix_timestamp()</td>
<td>返回当前Unix时间戳表示的秒数</td>
</tr>
<tr>
<td>bigint</td>
<td>unix_timestamp(string date)</td>
<td>将格式为yyyy-MM-dd HH：mm：ss的字符串转换为Unix时间戳（秒），使用默认的时区和区域，如果失败返回0</td>
</tr>
<tr>
<td>bigint</td>
<td>unix_timestamp(string date, string pattern)</td>
<td>根据指定模式将时间字符串转换为Unix时间戳（秒），失败返回0</td>
</tr>
<tr>
<td>string</td>
<td>to_date(string timestamp)</td>
<td>返回时间戳字符串的日期部分，如：to_date(“1970-01-01 00:00:00”) = “1970-01-01”</td>
</tr>
<tr>
<td>int</td>
<td>year(string date)</td>
<td>返回日期或时间戳字符串的年部分，如： year(“1970-01-01 00:00:00”) = 1970, year(“1970-01-01”) = 1970</td>
</tr>
<tr>
<td>int</td>
<td>month(string date)</td>
<td>返回日期或时间戳字符串的月部分，如： month(“1970-11-01 00:00:00”) = 11, month(“1970-11-01”) = 11</td>
</tr>
<tr>
<td>int</td>
<td>day(string date) dayofmonth(date)</td>
<td>返回日期或时间戳字符串的天部分，如：day(“1970-11-01 00:00:00”) = 1, day(“1970-11-01”) = 1</td>
</tr>
<tr>
<td>int</td>
<td>hour(string date)</td>
<td>返回时间戳的小时部分： hour(‘2009-07-30 12:58:59’) = 12, hour(‘12:58:59’) = 12</td>
</tr>
<tr>
<td>int</td>
<td>minute(string date)</td>
<td>返回时间戳的分钟</td>
</tr>
<tr>
<td>int</td>
<td>second(string date)</td>
<td>返回时间戳的秒</td>
</tr>
<tr>
<td>int</td>
<td>weekofyear(string date)</td>
<td>返回时间戳的星期数，如： weekofyear(“1970-11-01 00:00:00”) = 44, weekofyear(“1970-11-01”) = 44</td>
</tr>
<tr>
<td>int</td>
<td>datediff(string enddate, string startdate)</td>
<td>返回从startdate到enddate的天数，如： datediff(‘2009-03-01’, ‘2009-02-27’) = 2</td>
</tr>
<tr>
<td>string</td>
<td>date_add(string startdate, int days)</td>
<td>向startdate增加指定的天数，如： date_add(‘2008-12-31’, 1) = ‘2009-01-01’</td>
</tr>
<tr>
<td>string</td>
<td>date_sub(string startdate, int days)</td>
<td>从startdate减去指定的天数，如： date_sub(‘2008-12-31’, 1) = ‘2008-12-30’</td>
</tr>
<tr>
<td>timestamp</td>
<td>from_utc_timestamp(timestamp, string timezone)</td>
<td>假设给定时间戳为UTC时间，并将其转换为给定时区的时间戳</td>
</tr>
<tr>
<td>timestamp</td>
<td>to_utc_timestamp(timestamp, string timezone)</td>
<td>假设给定时间戳为给定时区的时间，将其转换为UTC时间戳</td>
</tr>
</tbody>
</table>
<h2 id="条件函数"><a href="#条件函数" class="headerlink" title="条件函数"></a>条件函数</h2><p>下表为Hive支持的一些条件函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>T</td>
<td>if(boolean testCondition, T valueTrue, T valueFalseOrNull)</td>
<td>如果testCondition为真，返回valueTrue，否则返回valueFalseOrNull</td>
</tr>
<tr>
<td>T</td>
<td>COALESCE(T v1, T v2, …)</td>
<td>返回第一个不是NULL的v，若全部为NULL，返回NULL</td>
</tr>
<tr>
<td>T</td>
<td>CASE a WHEN b THEN c [WHEN d THEN e]* [ELSE f] END</td>
<td>当a=b返回c，当a=d返回e，其它返回f</td>
</tr>
<tr>
<td>T</td>
<td>CASE WHEN a THEN b [WHEN c THEN d]* [ELSE e] END</td>
<td>当a=true返回b，当c=true返回d，其它返回e</td>
</tr>
</tbody>
</table>
<h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><p>下表为Hive内置的字符串函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>int</td>
<td>ascii(string str)</td>
<td>返回str第一个字符串的数值</td>
</tr>
<tr>
<td>string</td>
<td>base64(binary bin)</td>
<td>将二进制参数转换为base64字符串</td>
</tr>
<tr>
<td>string</td>
<td>concat(string\</td>
<td>binary A, string\</td>
<td>binary B…)</td>
<td>返回将A和B按顺序连接在一起的字符串，如：concat(‘foo’, ‘bar’) 返回’foobar’</td>
</tr>
<tr>
<td>array&lt;struct&lt;string,double&gt;&gt;</td>
<td>context_ngrams(array&lt;array<string>&gt;, array<string>, int K, int pf)</string></string></td>
<td>从一组标记化的句子中返回前k个文本</td>
</tr>
<tr>
<td>string</td>
<td>concat_ws(string SEP, string A, string B…)</td>
<td>类似concat() ，但使用自定义的分隔符SEP</td>
</tr>
<tr>
<td>string</td>
<td>concat_ws(string SEP, array<string>)</string></td>
<td>类似concat_ws() ，但参数为字符串数组</td>
</tr>
<tr>
<td>string</td>
<td>decode(binary bin, string charset)</td>
<td>使用指定的字符集将第一个参数解码为字符串，如果任何一个参数为null，返回null。可选字符集为： ‘US_ASCII’, ‘ISO-8859-1’, ‘UTF-8’, ‘UTF-16BE’, ‘UTF-16LE’, ‘UTF-16’</td>
</tr>
<tr>
<td>binary</td>
<td>encode(string src, string charset)</td>
<td>使用指定的字符集将第一个参数编码为binary ，如果任一参数为null，返回null</td>
</tr>
<tr>
<td>int</td>
<td>find_in_set(string str, string strList)</td>
<td>返回str在strList中第一次出现的位置，strList为用逗号分隔的字符串，如果str包含逗号则返回0，若任何参数为null，返回null。如： find_in_set(‘ab’, ‘abc,b,ab,c,def’) 返回3</td>
</tr>
<tr>
<td>string</td>
<td>format_number(number x, int d)</td>
<td>将数字x格式化为’#,###,###.##’，四舍五入为d位小数位，将结果做为字符串返回。如果d=0，结果不包含小数点或小数部分</td>
</tr>
<tr>
<td>string</td>
<td>get_json_object(string json_string, string path)</td>
<td>从基于json path的json字符串中提取json对象，返回json对象的json字符串，如果输入的json字符串无效返回null。Json 路径只能有数字、字母和下划线，不允许大写和其它特殊字符</td>
</tr>
<tr>
<td>boolean</td>
<td>in_file(string str, string filename)</td>
<td>如果str在filename中以正行的方式出现，返回true</td>
</tr>
<tr>
<td>int</td>
<td>instr(string str, string substr)</td>
<td>返回substr在str中第一次出现的位置。若任何参数为null返回null，若substr不在str中返回0。Str中第一个字符的位置为1</td>
</tr>
<tr>
<td>int</td>
<td>length(string A)</td>
<td>返回A的长度</td>
</tr>
<tr>
<td>int</td>
<td>locate(string substr, string str[, int pos])</td>
<td>返回substr在str的位置pos后第一次出现的位置</td>
</tr>
<tr>
<td>string</td>
<td>lower(string A) lcase(string A)</td>
<td>返回字符串的小写形式</td>
</tr>
<tr>
<td>string</td>
<td>lpad(string str, int len, string pad)</td>
<td>将str左侧用字符串pad填充，长度为len</td>
</tr>
<tr>
<td>string</td>
<td>ltrim(string A)</td>
<td>去掉字符串A左侧的空格，如：ltrim(‘ foobar ‘)的结果为’foobar ‘</td>
</tr>
<tr>
<td>array&lt;struct&lt;string,double&gt;&gt;</td>
<td>ngrams(array&lt;array<string>&gt;, int N, int K, int pf)</string></td>
<td>从一组标记化的Returns the top-k 句子中返回前K个N-grams</td>
</tr>
<tr>
<td>string</td>
<td>parse_url(string urlString, string partToExtract [, string keyToExtract])</td>
<td>返回给定URL的指定部分，partToExtract的有效值包括HOST，PATH， QUERY， REF， PROTOCOL， AUTHORITY，FILE和USERINFO。例如：  parse_url(‘<a href="http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#39;" target="_blank" rel="noopener">http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#39;</a>, ‘HOST’) 返回 ‘facebook.com’.。当第二个参数为QUERY时，可以使用第三个参数提取特定参数的值，例如： parse_url(‘<a href="http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#39;" target="_blank" rel="noopener">http://facebook.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#39;</a>, ‘QUERY’, ‘k1’) 返回’v1’</td>
</tr>
<tr>
<td>string</td>
<td>printf(String format, Obj… args)</td>
<td>将输入参数进行格式化输出</td>
</tr>
<tr>
<td>string</td>
<td>regexp_extract(string subject, string pattern, int index)</td>
<td>使用pattern从给定字符串中提取字符串。如： regexp_extract(‘foothebar’, ‘foo(.*?)(bar)’, 2) 返回’bar’ 有时需要使用预定义的字符类：使用’\s’ 做为第二个参数将匹配s，’s’匹配空格等。参数index是Java正则匹配器方法group()方法中的索引</td>
</tr>
<tr>
<td>string</td>
<td>regexp_replace(string INITIAL_STRING, string PATTERN, string REPLACEMENT)</td>
<td>使用REPLACEMENT替换字符串INITIAL_STRING中匹配PATTERN的子串，例如： regexp_replace(“foobar”, “oo\</td>
<td>ar”, “”) 返回’fb’</td>
</tr>
<tr>
<td>string</td>
<td>repeat(string str, int n)</td>
<td>将str重复n次</td>
</tr>
<tr>
<td>string</td>
<td>reverse(string A)</td>
<td>将字符串A翻转</td>
</tr>
<tr>
<td>string</td>
<td>rpad(string str, int len, string pad)</td>
<td>在str的右侧使用pad填充至长度len</td>
</tr>
<tr>
<td>string</td>
<td>rtrim(string A)</td>
<td>去掉字符串A右侧的空格，如： rtrim(‘ foobar ‘) 返回 ‘ foobar’</td>
</tr>
<tr>
<td>array&lt;array<string>&gt;</string></td>
<td>sentences(string str, string lang, string locale)</td>
<td>将自然语言文本处理为单词和句子，每个句子在适当的边界分割，返回单词的数组。参数lang和local<a href="https://www.baidu.com/s?wd=%E4%B8%BA%E5%8F%AF&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">为可</a>选参数，例如： sentences(‘Hello there! How are you?’) 返回( (“Hello”, “there”), (“How”, “are”, “you”) )</td>
</tr>
<tr>
<td>string</td>
<td>space(int n)</td>
<td>返回n个空格的字符串</td>
</tr>
<tr>
<td>array</td>
<td>split(string str, string pat)</td>
<td>用pat分割字符串str，pat为正则表达式</td>
</tr>
<tr>
<td>map&lt;string,string&gt;</td>
<td>str_to_map(text[, delimiter1, delimiter2])</td>
<td>使用两个分隔符将文本分割为键值对。第一个分隔符将文本分割为K-V 对，第二个分隔符分隔每个K-V 对。默认第一个分隔符为“<strong>，</strong>“，第二个分隔符为=</td>
</tr>
<tr>
<td>string</td>
<td>substr(string\</td>
<td>binary A, int start) substring(string\</td>
<td>binary A, int start)</td>
<td>返回A从位置start直到结尾的子串</td>
</tr>
<tr>
<td>string</td>
<td>substr(string\</td>
<td>binary A, int start, int len) substring(string\</td>
<td>binary A, int start, int len)</td>
<td>返回A中从位置start开始，长度为len的子串，如： substr(‘foobar’, 4, 1) 返回 ‘b’</td>
</tr>
<tr>
<td>string</td>
<td>translate(string input, string from, string to)</td>
<td>将input中出现在from中的字符替换为to中的字符串，如果任何参数为null，结果为null</td>
</tr>
<tr>
<td>string</td>
<td>trim(string A)</td>
<td>去掉字符串A两端的空格</td>
</tr>
<tr>
<td>binary</td>
<td>unbase64(string str)</td>
<td>将base64字符串转换为二进制</td>
</tr>
<tr>
<td>string</td>
<td>upper(string A) ucase(string A)</td>
<td>返回字符串A的大写形式</td>
</tr>
</tbody>
</table>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p>下表为Hive内置的聚合函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>BIGINT</td>
<td>count(*)count(expr)count(DISTINCT expr[, expr_.])</td>
<td>count(*) – 返回检索到的行的总数，包括含有NULL值的行。count(expr) – 返回expr表达式不是NULL的行的数量count(DISTINCT expr[, expr]) – 返回expr是唯一的且非NULL的行的数量</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>sum(col)sum(DISTINCT col)</td>
<td>对组内某列求和（包含重复值）或者对组内某列求和（不包含重复值）</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>avg(col),avg(DISTINCT col)</td>
<td>对组内某列元素求平均值者（包含重复值或不包含重复值）</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>min(col)</td>
<td>返回组内某列的最小值</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>max(col)</td>
<td>返回组内某列的最大值</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>variance(col),var_pop(col)</td>
<td>返回组内某个数字列的方差</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>var_samp(col)</td>
<td>返回组内某个数字列的无偏样本方差</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>stddev_pop(col)</td>
<td>返回组内某个数字列的标准差</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>stddev_samp(col)</td>
<td>返回组内某个数字列的无偏样本标准差</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>covar_pop(col1, col2)</td>
<td>返回组内两个数字列的总体协方差</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>covar_samp(col1, col2)</td>
<td>返回组内两个数字列的样本协方差</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>corr(col1, col2)</td>
<td>返回组内两个数字列的皮尔逊相关系数</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>percentile(BIGINT col, p)</td>
<td>返回组内某个列精确的第p位百分数，p必须在0和1之间</td>
</tr>
<tr>
<td>array<double></double></td>
<td>percentile(BIGINT col, array(p1 [, p2]…))</td>
<td>返回组内某个列精确的第p1，p2，……位百分数，p必须在0和1之间</td>
</tr>
<tr>
<td>DOUBLE</td>
<td>percentile_approx(DOUBLE col, p [, B])</td>
<td>返回组内数字列近似的第p位百分数（包括浮点数），参数B控制近似的精确度，B值越大，近似度越高，默认值为<a href="https://www.baidu.com/s?wd=10000&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">10000</a>。当列<a href="https://www.baidu.com/s?wd=%E4%B8%AD%E9%9D%9E&amp;tn=24004469_oem_dg&amp;rsv_dl=gh_pl_sl_csd" target="_blank" rel="noopener">中非</a>重复值的数量小于B时，返回精确的百分数</td>
</tr>
<tr>
<td>array<double></double></td>
<td>percentile_approx(DOUBLE col, array(p1 [, p2]…) [, B])</td>
<td>同上，但接受并返回百分数数组</td>
</tr>
<tr>
<td>array&lt;struct {‘x’,’y’}&gt;</td>
<td>histogram_numeric(col, b)</td>
<td>使用b个非均匀间隔的箱子计算组内数字列的柱状图（直方图），输出的数组大小为b，double类型的(x,y)表示直方图的中心和高度</td>
</tr>
<tr>
<td>array</td>
<td>collect_set(col)</td>
<td>返回消除了重复元素的数组</td>
</tr>
<tr>
<td>array</td>
<td>collect_list(col)</td>
<td>返回允许重复元素的数组</td>
</tr>
<tr>
<td>INTEGER</td>
<td>ntile(INTEGER x)</td>
<td>该函数将已经排序的分区分到x个桶中，并为每行分配一个桶号。这可以容易的计算三分位，四分位，十分位，百分位和其它通用的概要统计</td>
</tr>
</tbody>
</table>
<h2 id="内置-Table-Generating函数（UDTF）"><a href="#内置-Table-Generating函数（UDTF）" class="headerlink" title="内置 Table-Generating函数（UDTF）"></a>内置 Table-Generating函数（UDTF）</h2><p>正常的用户定义函数，如concat，输入一个单行然后输出一个单行，但table-generating函数将一个单输入行转换为多个输出行。下表为Hive内置的table-generating函数。</p>
<table>
<thead>
<tr>
<th><strong>返回类型</strong></th>
<th><strong>函数名</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>N rows</td>
<td>explode(ARRAY)</td>
<td>参数列为数组类型，将数组数据中的每个元素做为一行返回</td>
</tr>
<tr>
<td>N rows</td>
<td>explode(MAP)</td>
<td>将输入map中的每个键值对转换为两列，一列为key，另一列为value，然后返回新行</td>
</tr>
<tr>
<td></td>
<td>inline(ARRAY&lt;STRUCT[,STRUCT]&gt;)</td>
<td>分解struct数组到表中</td>
</tr>
<tr>
<td>Array Type</td>
<td>explode(array&lt;<em>TYPE</em>&gt; a)</td>
<td>对于数组a中的每个元素，该函数产生包含该元素的行For</td>
</tr>
<tr>
<td>元组</td>
<td>json_tuple(jsonStr, k1, k2, …)</td>
<td>参数为一组键k1，k2……和JSON字符串，返回值的元组。该方法比 <code>get_json_object</code> 高效，因为可以在一次调用中输入多个键</td>
</tr>
<tr>
<td>元组</td>
<td>parse_url_tuple(url, p1, p2, …)</td>
<td>该方法同<code>parse_url()</code> 相似，但可以一次性提取URL的多个部分，有效的参数名称为： HOST, PATH, QUERY, REF, PROTOCOL, AUTHORITY, FILE, USERINFO, QUERY:<key></key></td>
</tr>
<tr>
<td>N rows</td>
<td>posexplode(ARRAY)</td>
<td>行为与参数为数组的explode方法相似，但包含项在原始数组中的位置，返回(pos,value)的二元组</td>
</tr>
<tr>
<td></td>
<td>stack(INT n, v_1, v_2, …, v_k)</td>
<td>将v_1, …, v_k 分为n行，每行包含n/k列，n必须为常数</td>
</tr>
</tbody>
</table>
<p>使用语法”SELECT udtf(col) AS colAlias…”有以下几点限制：</p>
<ul>
<li>在SELECT中不允许再有其他表达式：不支持SELECT pageid, explode(adid_list) AS myCol…</li>
<li>UDTF不能够嵌套使用：不支持SELECT explode(explode(adid_list)) AS myCol…</li>
<li>不支持GROUP BY /CLUSTER BY / DISTRIBUTE BY / SORT BY：不支持SELECT explode(adid_list) AS myCol … GROUP BY myCol</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/Hive/1-什么是Hive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/Hive/1-什么是Hive/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Apache Hive</strong>是一个建立在<a href="https://zh.wikipedia.org/wiki/Hadoop" target="_blank" rel="noopener">Hadoop</a>架构之上的数据仓库。它能够提供数据的精炼，查询和分析。Apache Hive起初由<a href="https://zh.wikipedia.org/wiki/Facebook" target="_blank" rel="noopener">Facebook</a>开发，目前也有其他公司使用和开发Apache Hive，例如<a href="https://zh.wikipedia.org/wiki/Netflix" target="_blank" rel="noopener">Netflix</a>等。<a href="https://zh.wikipedia.org/wiki/%E4%BA%9A%E9%A9%AC%E9%80%8A%E5%85%AC%E5%8F%B8" target="_blank" rel="noopener">亚马逊公司</a>也开发了一个定制版本的Apache Hive，亚马逊网络服务包中的Amazon Elastic MapReduce包含了该定制版本。</p>
<p><a href="https://hive.apache.org/" target="_blank" rel="noopener">hive</a>是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的<a href="https://zh.wikipedia.org/wiki/SQL" target="_blank" rel="noopener">SQL</a>查询功能，可以将SQL语句转换为MapReduce任务进行运行。其优点是学习成本低，可以通过类SQL语句快速实现简单的MapReduce统计，不必开发专门的MapReduce应用，十分适合数据仓库的统计分析。</p>
<p>Hive缺点：</p>
<p>不支持删除和修改</p>
<p>查询延时性强</p>
<p>不支持事务</p>
<p>Hive架构</p>
<p>用户接口层 :cli 命令行客户端，jdbc,odbc,java api</p>
<p>元数据库，保存元数据，关系型数据库</p>
<p>thrift服务：跨语言服务</p>
<p>驱动层：</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/03/hbase/1-hbase/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/03/hbase/1-hbase/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-04-03T15:15:00+08:00">
                2019-04-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hbase-shell"><a href="#hbase-shell" class="headerlink" title="hbase shell"></a>hbase shell</h1><h2 id="1-ddl"><a href="#1-ddl" class="headerlink" title="1.ddl"></a>1.ddl</h2><h3 id="1-create"><a href="#1-create" class="headerlink" title="1.create"></a>1.create</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):003:0&gt; create help</span><br></pre></td></tr></table></figure>
<p>create 语法</p>
<blockquote>
<p>Here is some help for this command:<br>Creates a table. Pass a table name, and a set of column family<br>specifications (at least one), and, optionally, table configuration.<br>Column specification can be a simple string (name), or a dictionary<br>(dictionaries are described below in main help output), necessarily<br>including NAME attribute.<br>Examples:</p>
<p>Create a table with namespace=ns1 and table qualifier=t1<br>  hbase&gt; create ‘ns1:t1’, {NAME =&gt; ‘f1’, VERSIONS =&gt; 5}</p>
<p>Create a table with namespace=default and table qualifier=t1<br>  hbase&gt; create ‘t1’, {NAME =&gt; ‘f1’}, {NAME =&gt; ‘f2’}, {NAME =&gt; ‘f3’}<br>  hbase&gt; # The above in shorthand would be the following:<br>  hbase&gt; create ‘t1’, ‘f1’, ‘f2’, ‘f3’<br>  hbase&gt; create ‘t1’, {NAME =&gt; ‘f1’, VERSIONS =&gt; 1, TTL =&gt; 2592000, BLOCKCACHE =&gt; true}<br>  hbase&gt; create ‘t1’, {NAME =&gt; ‘f1’, CONFIGURATION =&gt; {‘hbase.hstore.blockingStoreFiles’ =&gt; ‘10’}}</p>
<p>Table configuration options can be put at the end.<br>Examples:</p>
<p>  hbase&gt; create ‘ns1:t1’, ‘f1’, SPLITS =&gt; [‘10’, ‘20’, ‘30’, ‘40’]<br>  hbase&gt; create ‘t1’, ‘f1’, SPLITS =&gt; [‘10’, ‘20’, ‘30’, ‘40’]<br>  hbase&gt; create ‘t1’, ‘f1’, SPLITS_FILE =&gt; ‘splits.txt’, OWNER =&gt; ‘johndoe’<br>  hbase&gt; create ‘t1’, {NAME =&gt; ‘f1’, VERSIONS =&gt; 5}, METADATA =&gt; { ‘mykey’ =&gt; ‘myvalue’ }<br>  hbase&gt; # Optionally pre-split the table into NUMREGIONS, using<br>  hbase&gt; # SPLITALGO (“HexStringSplit”, “UniformSplit” or classname)<br>  hbase&gt; create ‘t1’, ‘f1’, {NUMREGIONS =&gt; 15, SPLITALGO =&gt; ‘HexStringSplit’}<br>  hbase&gt; create ‘t1’, ‘f1’, {NUMREGIONS =&gt; 15, SPLITALGO =&gt; ‘HexStringSplit’, REGION_REPLICATION =&gt; 2, CONFIGURATION =&gt; {‘hbase.hregion.scan.loadColumnFamiliesOnDemand’ =&gt; ‘true’}}<br>  hbase&gt; create ‘t1’, {NAME =&gt; ‘f1’, DFS_REPLICATION =&gt; 1}</p>
<p>You can also keep around a reference to the created table:</p>
<p>  hbase&gt; t1 = create ‘t1’, ‘f1’</p>
<p>Which gives you a reference to the table named ‘t1’, on which you can then<br>call methods.</p>
</blockquote>
<p><code>create &#39;t1&#39;, {NAME =&gt; &#39;f1&#39;}, {NAME =&gt; &#39;f2&#39;}, {NAME =&gt; &#39;f3&#39;}</code></p>
<p>或者</p>
<p><code>create &#39;t1&#39;, &#39;f1&#39;, &#39;f2&#39;, &#39;f3&#39;</code></p>
<p>t1表名,f1,f2,f3列簇</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">'stu'</span>,<span class="string">'info'</span>,<span class="string">'score'</span></span><br><span class="line">list</span><br><span class="line">describe <span class="string">'stu'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>stu<br>COLUMN FAMILIES DESCRIPTION<br>{NAME =&gt; ‘info’, BLOOMFILTER =&gt; ‘ROW’, VERSIONS =&gt; ‘1’, IN_MEMORY =&gt; ‘false’, KEEP_DELETED_CELLS =&gt; ‘FALSE’, DATA_BLOCK_ENCODING =&gt; ‘NONE’, TTL =&gt;<br> ‘FOREVER’, COMPRESSION =&gt; ‘NONE’, MIN_VERSIONS =&gt; ‘0’, BLOCKCACHE =&gt; ‘true’, BLOCKSIZE =&gt; ‘65536’, REPLICATION_SCOPE =&gt; ‘0’}<br>{NAME =&gt; ‘score’, BLOOMFILTER =&gt; ‘ROW’, VERSIONS =&gt; ‘1’, IN_MEMORY =&gt; ‘false’, KEEP_DELETED_CELLS =&gt; ‘FALSE’, DATA_BLOCK_ENCODING =&gt; ‘NONE’, TTL =&gt;’FOREVER’, COMPRESSION =&gt; ‘NONE’, MIN_VERSIONS =&gt; ‘0’, BLOCKCACHE =&gt; ‘true’, BLOCKSIZE =&gt; ‘65536’, REPLICATION_SCOPE =&gt; ‘0’}</p>
</blockquote>
<p><code>TTL =&gt; &#39;FOREVER&#39;</code>:生命周期，永久保存</p>
<h3 id="2-drop"><a href="#2-drop" class="headerlink" title="2.drop"></a>2.drop</h3><p>先禁用，再删除</p>
<blockquote>
<p>hbase(main):055:0&gt; drop ‘stu’</p>
<p>ERROR: Table stu is enabled. Disable it first.</p>
</blockquote>
<h2 id="2-DML"><a href="#2-DML" class="headerlink" title="2.DML"></a>2.DML</h2><h3 id="1-insert"><a href="#1-insert" class="headerlink" title="1.insert"></a>1.insert</h3><p>put help</p>
<blockquote>
<p>Put a cell ‘value’ at specified table/row/column and optionally<br>timestamp coordinates.  To put a cell value into table ‘ns1:t1’ or ‘t1’<br>at row ‘r1’ under column ‘c1’ marked with the time ‘ts1’, do:</p>
<p>  hbase&gt; put ‘ns1:t1’, ‘r1’, ‘c1’, ‘value’<br>  hbase&gt; put ‘t1’, ‘r1’, ‘c1’, ‘value’<br>  hbase&gt; put ‘t1’, ‘r1’, ‘c1’, ‘value’, ts1<br>  hbase&gt; put ‘t1’, ‘r1’, ‘c1’, ‘value’, {ATTRIBUTES=&gt;{‘mykey’=&gt;’myvalue’}}<br>  hbase&gt; put ‘t1’, ‘r1’, ‘c1’, ‘value’, ts1, {ATTRIBUTES=&gt;{‘mykey’=&gt;’myvalue’}}<br>  hbase&gt; put ‘t1’, ‘r1’, ‘c1’, ‘value’, ts1, {VISIBILITY=&gt;’PRIVATE|SECRET’}</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">put  <span class="string">'stu'</span>, <span class="string">'rk_001'</span>, <span class="string">'info:name'</span>, <span class="string">'lucy'</span></span><br><span class="line">put  <span class="string">'stu'</span>, <span class="string">'rk_001'</span>, <span class="string">'info:age'</span>, <span class="string">'18'</span></span><br><span class="line">put  <span class="string">'stu'</span>, <span class="string">'rk_001'</span>, <span class="string">'info:gender'</span>, <span class="string">'1'</span></span><br><span class="line">scan <span class="string">'stu'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>ROW                                      COLUMN+CELL<br> rk_001                                  column=info:age, timestamp=1552438545316, value=18<br> rk_001                                  column=info:gender, timestamp=1552438550563, value=1<br> rk_001                                  column=info:name, timestamp=1552438472942, value=lily </p>
</blockquote>
<p>put成功后数据写在缓存中，重启hbase后会写到hdfs</p>
<p><code>/hbase/data/default/stu/be61351336a6c3c2062ef271477b4ca3/info/46914bf186914c818b7b0291cd4727b0</code></p>
<p>hbase，配置在hbase-site.xml</p>
<p>defalut，为namespace</p>
<p>be61351336a6c3c2062ef271477b4ca3，为region</p>
<p>info，为列簇</p>
<p> 46914bf186914c818b7b0291cd4727b0，列簇的存储文件，Hfile</p>
<p>2.查询get</p>
<p>get hlep</p>
<blockquote>
<p>  hbase&gt; t.get ‘r1’<br>  hbase&gt; t.get ‘r1’, {TIMERANGE =&gt; [ts1, ts2]}<br>  hbase&gt; t.get ‘r1’, {COLUMN =&gt; ‘c1’}<br>  hbase&gt; t.get ‘r1’, {COLUMN =&gt; [‘c1’, ‘c2’, ‘c3’]}<br>  hbase&gt; t.get ‘r1’, {COLUMN =&gt; ‘c1’, TIMESTAMP =&gt; ts1}<br>  hbase&gt; t.get ‘r1’, {COLUMN =&gt; ‘c1’, TIMERANGE =&gt; [ts1, ts2], VERSIONS =&gt; 4}<br>  hbase&gt; t.get ‘r1’, {COLUMN =&gt; ‘c1’, TIMESTAMP =&gt; ts1, VERSIONS =&gt; 4}<br>  hbase&gt; t.get ‘r1’, {FILTER =&gt; “ValueFilter(=, ‘binary:abc’)”}<br>  hbase&gt; t.get ‘r1’, ‘c1’<br>  hbase&gt; t.get ‘r1’, ‘c1’, ‘c2’<br>  hbase&gt; t.get ‘r1’, [‘c1’, ‘c2’]<br>  hbase&gt; t.get ‘r1’, {CONSISTENCY =&gt; ‘TIMELINE’}<br>  hbase&gt; t.get ‘r1’, {CONSISTENCY =&gt; ‘TIMELINE’, REGION_REPLICA_ID =&gt; 1}</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###根据rowkey查询</span></span><br><span class="line">get <span class="string">'stu'</span>,<span class="string">'rk_001'</span></span><br><span class="line"><span class="comment">###根据时间戳范围查询</span></span><br><span class="line">get <span class="string">'stu'</span>,<span class="string">'rk_001'</span>,&#123;TIMERANGE=&gt;[1552438472941,1552438550564]&#125;</span><br><span class="line"><span class="comment">###根据rowkey范围查询</span></span><br><span class="line">scan <span class="string">'stu'</span>,&#123;STARTROW=&gt;<span class="string">'rk_001'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>3.scan</p>
<p>scan help</p>
<blockquote>
<p> hbase&gt; scan ‘hbase:meta’<br>   hbase&gt; scan ‘hbase:meta’, {COLUMNS =&gt; ‘info:regioninfo’}<br>   hbase&gt; scan ‘ns1:t1’, {COLUMNS =&gt; [‘c1’, ‘c2’], LIMIT =&gt; 10, STARTROW =&gt; ‘xyz’}<br>   hbase&gt; scan ‘t1’, {COLUMNS =&gt; [‘c1’, ‘c2’], LIMIT =&gt; 10, STARTROW =&gt; ‘xyz’}<br>   hbase&gt; scan ‘t1’, {COLUMNS =&gt; ‘c1’, TIMERANGE =&gt; [1303668804, 1303668904]}<br>   hbase&gt; scan ‘t1’, {REVERSED =&gt; true}<br>   hbase&gt; scan ‘t1’, {ALL_METRICS =&gt; true}<br>   hbase&gt; scan ‘t1’, {METRICS =&gt; [‘RPC_RETRIES’, ‘ROWS_FILTERED’]}<br>   hbase&gt; scan ‘t1’, {ROWPREFIXFILTER =&gt; ‘row2’, FILTER =&gt; “<br>     (QualifierFilter (&gt;=, ‘binary:xyz’)) AND (TimestampsFilter ( 123, 456))”}<br>   hbase&gt; scan ‘t1’, {FILTER =&gt;<br>     org.apache.hadoop.hbase.filter.ColumnPaginationFilter.new(1, 0)}<br>   hbase&gt; scan ‘t1’, {CONSISTENCY =&gt; ‘TIMELINE’}<br> For setting the Operation Attributes<br>   hbase&gt; scan ‘t1’, { COLUMNS =&gt; [‘c1’, ‘c2’], ATTRIBUTES =&gt; {‘mykey’ =&gt; ‘myvalue’}}<br>   hbase&gt; scan ‘t1’, { COLUMNS =&gt; [‘c1’, ‘c2’], AUTHORIZATIONS =&gt; [‘PRIVATE’,’SECRET’]}</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scan <span class="string">'stu'</span>,&#123;STARTROW=&gt;<span class="string">'rk_001'</span>&#125;</span><br><span class="line">scan <span class="string">'stu'</span>,&#123;COLUMNS =&gt; <span class="string">'info'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>4.delete</p>
<p>delete help</p>
<blockquote>
<p>  hbase&gt; delete ‘ns1:t1’, ‘r1’, ‘c1’, ts1<br>   hbase&gt; delete ‘t1’, ‘r1’, ‘c1’, ts1<br>   hbase&gt; delete ‘t1’, ‘r1’, ‘c1’, ts1, {VISIBILITY=&gt;’PRIVATE|SECRET’}</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete <span class="string">'stu'</span>,<span class="string">'rk_001'</span>,<span class="string">'info:age'</span>,1552438545316</span><br></pre></td></tr></table></figure>
<p>5.truncate</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">truncate <span class="string">'stu'</span></span><br></pre></td></tr></table></figure>
<p>先禁用再清空，清空后又启用</p>
<blockquote>
<p>hbase(main):054:0&gt; truncate ‘stu’<br>Truncating ‘stu’ table (it may take a while):</p>
<ul>
<li>Disabling table…</li>
<li>Truncating table…<br>0 row(s) in 4.4070 seconds</li>
</ul>
</blockquote>
<p>Java API 操作<br>HBase提供了Java API的访问接口，实际开发中我们经常用来操作HBase，就和我们通过Java API操作RDBMS一样。笔者对HBase 中的常用Java API做了个简要的总结，如下</p>
<p>Java API    作用<br>HBaseAdmin    HBase 客户端，用来操作HBase<br>Configuration    配置对象<br>Connection    连接对象<br>TableName    HBase 中的表名<br>HTableDescriptor    HBase 表描述信息对象<br>HColumnDescriptor    HBase 列族描述对象<br>Table    HBase 表对象<br>Put    用于插入数据<br>Get    用于查询单条记录<br>Delete    删除数据对象<br>Scan    全表扫描对象，查询所有记录<br>ResultScanner    查询数据返回结果集<br>Result    查询返回的单条记录结果<br>Cell    对应HBase中的列<br>SingleColumnValueFilter    列值过滤器（过滤列植的相等、不等、范围等）<br>ColumnPrefixFilter    列名前缀过滤器（过滤指定前缀的列名）<br>multipleColumnPrefixFilter    多个列名前缀过滤器（过滤多个指定前缀的列名）<br>RowFilter    rowKey过滤器（通过正则，过滤rowKey值）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">42</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
